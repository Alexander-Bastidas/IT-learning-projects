#!/usr/bin/env python3
"""
Calculator CLI (Konsolenanwendung)
- Grundrechenarten: +, -, *, /
- Potenz und Modulo
- Eingabevalidierung und Fehlerbehandlung
"""

from __future__ import annotations


def lese_float(prompt: str) -> float:
    while True:
        eingabe = input(prompt).strip().replace(",", ".")
        try:
            return float(eingabe)
        except ValueError:
            print("‚ùå Ung√ºltige Eingabe. Bitte eine Zahl eingeben (z.B. 3.14).")


def lese_auswahl(prompt: str, gueltig: set[str]) -> str:
    while True:
        auswahl = input(prompt).strip().lower()
        if auswahl in gueltig:
            return auswahl
        print(f"‚ùå Ung√ºltige Option. G√ºltig sind: {', '.join(sorted(gueltig))}")


def berechne(a: float, b: float, op: str) -> float:
    if op == "1":      # Addition
        return a + b
    if op == "2":      # Subtraktion
        return a - b
    if op == "3":      # Multiplikation
        return a * b
    if op == "4":      # Division
        if b == 0:
            raise ZeroDivisionError("Division durch 0 ist nicht erlaubt.")
        return a / b
    if op == "5":      # Potenz
        return a ** b
    if op == "6":      # Modulo
        if b == 0:
            raise ZeroDivisionError("Modulo durch 0 ist nicht erlaubt.")

        return a % b

    raise ValueError("Unbekannte Operation.")


def main() -> None:
    menue = (
        "\n=== Calculator CLI ===\n"
        "1) Addition (+)\n"
        "2) Subtraktion (-)\n"
        "3) Multiplikation (*)\n"
        "4) Division (/)\n"
        "5) Potenz (**)\n"
        "6) Modulo (%)\n"
        "q) Beenden\n"
    )

    gueltige_optionen = {"1", "2", "3", "4", "5", "6", "q"}

    while True:
        print(menue)
        option = lese_auswahl("Option w√§hlen: ", gueltige_optionen)

        if option == "q":
            print("üëã Programm beendet.")
            return

        a = lese_float("Erste Zahl: ")
        b = lese_float("Zweite Zahl: ")

        try:
            ergebnis = berechne(a, b, option)
            print(f"‚úÖ Ergebnis: {ergebnis}")
        except ZeroDivisionError as e:
            print(f"‚ùå Fehler: {e}")
        except Exception as e:
            print(f"‚ùå Unerwarteter Fehler: {e}")

        nochmal = lese_auswahl("Weitere Berechnung? (j/n): ", {"j", "n"})
        if nochmal == "n":
            print("üëã Programm beendet.")
            return


if __name__ == "__main__":
    main()
